---
title: webpackä»‹ç»
description: webpackä»‹ç»
---

## webpack å…¥å‘

Webpack åœ¨å®é™…ä¸­çœŸçš„æ¥è§¦å°‘ä¹‹åˆå°‘ï¼Œæœ¬äººç¬¬ä¸€æ¬¡æ¥è§¦æ˜¯åœ¨é¢è¯•ä¸­ä½ æ•¢ä¿¡ï¼Ÿ

**em...ğŸµ æœ€æ€•ç©ºæ°”çªç„¶å®‰é™**

å¯ä»¥ä»é¢è¯•é¢˜ä¸‹æ‰‹ã€‚

> é—®ï¼šWebpack é…ç½®ä¸­ç”¨è¿‡å“ªäº› Loader ï¼Ÿéƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

> é—®ï¼šLoader å’Œ Plugin æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> é—®ï¼šWebpack æ‰“åŒ…æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ

> é—®ï¼šWebpack æ‰“åŒ…ä¸­ Babel æ’ä»¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

å¯¹äºåŠè·¯å‡ºå®¶ï¼Œå‚è€ƒç½‘ç»œçš„æ•™å­¦åå¾—å‡ºä¸‰ä¸ªé˜¶æ®µï¼š

1. åŸºç¡€ -- ä¼šé…ç½®
2. è¿›é˜¶ -- èƒ½ä¼˜åŒ–
3. æ·±å…¥ -- æ‡‚åŸç†ï¼ˆæš‚æ—¶å¼€ç©ç¬‘ï¼‰

::: details å¯ä»¥è·³è¿‡çš„æ‹“å±•ï¼ˆæ²¡å¿…è¦ç‚¹å¼€ï¼‰
:see_no_evil:
ä¸€äº› webpack çš„æ ¸å¿ƒé…ç½®æ¦‚å¿µï¼š
| æ¦‚å¿µ | è¯´æ˜ |
| ------------- |:-------------:|
| **å…¥å£(`entry`)** | å…¥å£èµ·ç‚¹(`entry point`) æŒ‡ç¤º `webpack` åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ ä¾èµ–å›¾(dependency graph) çš„å¼€å§‹ã€‚é»˜è®¤å€¼æ˜¯ `./src/index.js`ã€‚ |
| **è¾“å‡º(`output`)** | `output` å±æ€§å‘Šè¯‰ `webpack` åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundle,é»˜è®¤æ”¾ç½®åœ¨ `./dist` æ–‡ä»¶å¤¹ä¸­ã€‚ |
| `loader` | `loader` è®© `webpack` èƒ½å¤Ÿå»å¤„ç†å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºæœ‰æ•ˆ æ¨¡å—ï¼Œä»¥ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ |
| **æ’ä»¶(`plugin`)** | æ’ä»¶å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚åŒ…æ‹¬ï¼šæ‰“åŒ…ä¼˜åŒ–ï¼Œèµ„æºç®¡ç†ï¼Œæ³¨å…¥ç¯å¢ƒå˜é‡ã€‚ |
| **æ¨¡å¼(`mode`)** | é€šè¿‡é€‰æ‹© `development`, `production` æˆ– `none` ä¹‹ä¸­çš„ä¸€ä¸ªï¼Œæ¥è®¾ç½® `mode` å‚æ•°ï¼Œä½ å¯ä»¥å¯ç”¨ `webpack` å†…ç½®åœ¨ç›¸åº”ç¯å¢ƒä¸‹çš„ä¼˜åŒ–ã€‚å…¶é»˜è®¤å€¼ä¸º `production`ã€‚ |
:::

## webpack åŸºç¡€

### å¿«é€Ÿä¸Šæ‰‹

ä»é›¶å¼€å§‹ï¼Œå…ˆå…ˆæœ¬åœ°å®‰è£…ä¸€ä¸‹ webpack ä»¥åŠ webpack-cli

```shell
npm install webpack webpack-cli -D # å®‰è£…åˆ°æœ¬åœ°ä¾èµ–(ä¸æ¨èï¼š-Gæ˜¯å…¨å±€ä¾èµ–)
```

å¦‚æœå®‰è£…å®Œæˆä¼šåœ¨`package.json`çœ‹åˆ°å¦‚ä¸‹ï¼š âœ…

```js
 "devDependencies": {
    "webpack": "^5.65.0",
    "webpack-cli": "^4.9.1"
  }
```

`webpack `åœ¨ 4 ä»¥åå°±è¯´æ”¯æŒ 0 é…ç½®æ‰“åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š

1. æ–°å»º ./src/index.js æ–‡ä»¶ï¼Œå†™ä¸€æ®µç®€å•çš„`js`ä»£ç ï¼ˆéšä¾¿å†™ï¼‰

å¦‚ï¼š

```js
const a = "Hello ITEM";
console.log(a);
module.exports = a;
```

æ­¤æ—¶ç›®å½•ç»“æ„ï¼š

![](https://s2.loli.net/2022/01/09/jdNbqRSmMQpGge8.png)

2. ç›´æ¥è¿è¡Œ `npx webpack`ï¼Œå¯åŠ¨æ‰“åŒ…ï¼š
   ![](https://s2.loli.net/2022/01/09/YxpAlO2DWXt9cPd.png)

æ‰“åŒ…å®Œæˆï¼Œæˆ‘ä»¬çœ‹åˆ°æ—¥å¿—ä¸Šé¢æœ‰ä¸€æ®µæç¤ºï¼š`The 'mode' option has not been set,...`

æ„æ€å°±æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰é…ç½® `mode`ï¼ˆæ¨¡å¼ï¼‰ã€‚

> `æ¨¡å¼`ï¼š ä¾› mode é…ç½®é€‰é¡¹ï¼Œå‘ŠçŸ¥ webpack ä½¿ç”¨ç›¸åº”æ¨¡å¼çš„å†…ç½®ä¼˜åŒ–ï¼Œé»˜è®¤å€¼ä¸º `production`ï¼Œå¦å¤–è¿˜æœ‰ `development`ã€`none`ï¼Œä»–ä»¬çš„åŒºåˆ«å¦‚ä¸‹

æ€ä¹ˆé…ç½®ï¼Ÿçœ‹ä¸‹é¢ï¼š

```js
//1.åªéœ€åœ¨é…ç½®å¯¹è±¡ä¸­æä¾› mode é€‰é¡¹ï¼š
module.exports = {
  mode: 'development',
};
//2.ä» CLI å‚æ•°ä¸­ä¼ é€’ï¼š
$ webpack --mode=development
```

ä¸€èˆ¬ç”¨ä¸‹é¢é…ç½®æ–‡ä»¶æ–¹å¼é…ç½®ï¼š

### é…ç½®æ–‡ä»¶

åœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½è¦ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥æ»¡è¶³é¡¹ç›®éœ€æ±‚ï¼š

1. æ ¹è·¯å¾„ä¸‹æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ `webpack.config.js`
2. æ–°å¢åŸºæœ¬é…ç½®ä¿¡æ¯

```js
const path = require("path");
module.exports = {
  mode: "development", // æ¨¡å¼
  entry: "./src/index.js", // æ‰“åŒ…å…¥å£åœ°å€
  output: {
    filename: "bundle.js", // è¾“å‡ºæ–‡ä»¶å
    path: path.join(__dirname, "dist"), // è¾“å‡ºæ–‡ä»¶ç›®å½•
  },
};
```

ä¸Šé¢æ˜¯åŸºæœ¬çš„é…ç½®ï¼Œéœ€è¦æˆ‘è®°ä½ã€‚è®¸å¤šä¿®æ”¹éƒ½æ˜¯åŸºäºä¸Šé¢è¿›è¡Œã€‚

### Loader

å½“æˆ‘ä»¬æŠŠå…¥å£æ”¹æˆ CSS æ–‡ä»¶ï¼Œå¯èƒ½æ‰“åŒ…ç»“æœä¼šå¦‚ä½•ï¼š

1. æ–°å¢ ./src/main.css

```css
body {
  margin: 0 auto;
  padding: 0 20px;
  max-width: 800px;
  background: #f4f8fb;
}
```

2. ä¿®æ”¹ entry é…ç½®

```js
const path = require("path");

module.exports = {
  mode: "development", // æ¨¡å¼
  entry: "./src/main.css", // æ‰“åŒ…å…¥å£åœ°å€
  output: {
    filename: "bundle.css", // è¾“å‡ºæ–‡ä»¶å
    path: path.join(__dirname, "dist"), // è¾“å‡ºæ–‡ä»¶ç›®å½•
  },
};
```

3. è¿è¡Œæ‰“åŒ…å‘½ä»¤ï¼šnpx webpack

![](https://s2.loli.net/2022/01/09/3qpNyQVMrt9TLiJ.png)

æŠ¥é”™ï¼
å› ä¸º webpack é»˜è®¤æ”¯æŒå¤„ç† JS ä¸ JSON æ–‡ä»¶ï¼Œå…¶ä»–ç±»å‹éƒ½å¤„ç†ä¸äº†ï¼Œè¿™é‡Œå¿…é¡»å€ŸåŠ© Loader æ¥å¯¹ä¸åŒç±»å‹çš„æ–‡ä»¶çš„è¿›è¡Œå¤„ç†ã€‚

4. å®‰è£… `css-loader` æ¥å¤„ç† CSS

```bash
npm install css-loader -D
```

5. é…ç½®èµ„æºåŠ è½½æ¨¡å—

```js
const path = require("path");

module.exports = {
  mode: "development", // æ¨¡å¼
  entry: "./src/main.css", // æ‰“åŒ…å…¥å£åœ°å€
  output: {
    filename: "bundle.css", // è¾“å‡ºæ–‡ä»¶å
    path: path.join(__dirname, "dist"), // è¾“å‡ºæ–‡ä»¶ç›®å½•
  },
  module: {
    rules: [
      // è½¬æ¢è§„åˆ™
      {
        test: /\.css$/, //åŒ¹é…æ‰€æœ‰çš„ css æ–‡ä»¶
        use: "css-loader", // use: å¯¹åº”çš„ Loader åç§°
      },
    ],
  },
};
```

6. é‡æ–°è¿è¡Œæ‰“åŒ…å‘½ä»¤ npx webpack
   ![](https://s2.loli.net/2022/01/09/xHuTnfdtWLPIYo2.png)

æ‰“åŒ…æˆåŠŸï¼ŒæŸ¥çœ‹ dist çš„ç»“æœï¼š

```bash
dist
â””â”€ bundle.css  # æ‰“åŒ…å¾—åˆ°çš„ç»“æœ
```

æŸ¥çœ‹åˆ° bundle.css ä¼šæœ‰é”™è¯¯ï¼Œè¿™é‡Œè¿™æ˜¯å°è¯•ï¼Œå…¥å£æ–‡ä»¶è¿˜æ˜¯éœ€è¦æ”¹å› ./src/index.jsã€‚

::: tip æ€»ç»“
Loader å°±æ˜¯å°† Webpack ä¸è®¤è¯†çš„å†…å®¹è½¬åŒ–ä¸ºè®¤è¯†çš„å†…å®¹
:::

### æ’ä»¶ï¼ˆpluginï¼‰

ä¸ Loader ç”¨äºè½¬æ¢ç‰¹å®šç±»å‹çš„æ–‡ä»¶ï¼ˆå•ä¸€åŸåˆ™ï¼‰ä¸åŒï¼Œ**æ’ä»¶ï¼ˆPluginï¼‰å¯ä»¥è´¯ç©¿ Webpack æ‰“åŒ…çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡å½±å“è¾“å‡ºç»“æœï¼ˆé’ˆå¯¹æ•´ä¸ªæµç¨‹æ‰§è¡Œå¹¿æ³›çš„ä»»åŠ¡ï¼‰**

ä¾‹å­ä¸Šæ‰‹ï¼š

1. æ–°å»º `./src/index.html` æ–‡ä»¶

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
</html>
```

å¦‚æœæˆ‘æƒ³æ‰“åŒ…åçš„èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šjs æˆ–è€… css æ–‡ä»¶å¯ä»¥è‡ªåŠ¨å¼•å…¥åˆ° Html ä¸­ï¼Œå°±éœ€è¦ä½¿ç”¨æ’ä»¶ [html-webpack-plugin](https://www.npmjs.com/package/html-webpack-plugin)æ¥å¸®åŠ©ä½ å®Œæˆè¿™ä¸ªæ“ä½œ

2. æœ¬åœ°å®‰è£… `html-webpack-plugin`

```bash
npm install html-webpack-plugin -D
```

3. é…ç½®æ’ä»¶

```js
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  mode: "development", // æ¨¡å¼
  entry: "./src/index.js", // æ‰“åŒ…å…¥å£åœ°å€
  output: {
    filename: "bundle.js", // è¾“å‡ºæ–‡ä»¶å
    path: path.join(__dirname, "dist"), // è¾“å‡ºæ–‡ä»¶ç›®å½•
  },
  module: {
    rules: [
      {
        test: /\.css$/, //åŒ¹é…æ‰€æœ‰çš„ css æ–‡ä»¶
        use: "css-loader", // use: å¯¹åº”çš„ Loader åç§°
      },
    ],
  },
  plugins: [
    // é…ç½®æ’ä»¶
    new HtmlWebpackPlugin({
      template: "./src/index.html",
    }),
  ],
};
```

4. è¿è¡Œä¸€ä¸‹æ‰“åŒ…`npx webpack`ï¼Œæ‰“å¼€ dist ç›®å½•ä¸‹ç”Ÿæˆçš„ index.html æ–‡ä»¶

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script defer src="bundle.js"></script>
  </head>
  <body></body>
</html>
```

å¯ä»¥çœ‹åˆ°å®ƒè‡ªåŠ¨çš„å¼•å…¥äº†æ‰“åŒ…å¥½çš„ `bundle.js` ï¼Œéå¸¸æ–¹ä¾¿å®ç”¨

### è‡ªåŠ¨æ¸…ç©ºæ‰“åŒ…ç›®å½•

è¿™ä¸ªå†…å®¹æœ¬æ¥å±äºæ’ä»¶ï¼ˆpluginï¼‰çš„èŒƒç•´ï¼Œä½†ä¸€èˆ¬æ¯”è¾ƒå¸¸ç”¨ï¼›

æ¯æ¬¡æ‰“åŒ…çš„æ—¶å€™ï¼Œæ‰“åŒ…ç›®å½•éƒ½ä¼šé—ç•™ä¸Šæ¬¡æ‰“åŒ…çš„æ–‡ä»¶ï¼Œä¸ºäº†ä¿æŒæ‰“åŒ…ç›®å½•çš„çº¯å‡€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰“åŒ…å‰å°†æ‰“åŒ…ç›®å½•æ¸…ç©º

æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š

**ç¬¬ä¸€ã€webpack5 æ–°ç‰¹æ€§ï¼ˆclean:trueï¼‰**

```js {4}
    output: {
        filename: 'bundle.js', // è¾“å‡ºæ–‡ä»¶å
        path: path.join(__dirname, 'dist'), // è¾“å‡ºæ–‡ä»¶ç›®å½•
        clean:true,// è‡ªåŠ¨æ¸…ç©ºæ‰“åŒ…ç›®å½•
    },
```

ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ç‰ˆæœ¬å·ï¼›

**ç¬¬äºŒã€æ’ä»¶**

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ’ä»¶ [clean-webpack-plugin](https://www.npmjs.com/package/clean-webpack-plugin) æ¥å®ç°

1. å®‰è£…

```bash
$ npm install clean-webpack-plugin -D
```

2. é…ç½®

```js {12}
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
// å¼•å…¥æ’ä»¶
const { CleanWebpackPlugin } = require("clean-webpack-plugin");
//
module.exports = {
  // ...
  plugins: [
    // é…ç½®æ’ä»¶
    new HtmlWebpackPlugin({
      template: "./src/index.html",
    }),
    new CleanWebpackPlugin(), // å¼•å…¥æ’ä»¶
  ],
};
```

### åŒºåˆ†ç¯å¢ƒ

æœ¬åœ°å¼€å‘å’Œéƒ¨ç½²çº¿ä¸Šï¼Œè‚¯å®šæ˜¯æœ‰ä¸åŒçš„éœ€æ±‚

æœ¬åœ°ç¯å¢ƒï¼š

- éœ€è¦æ›´å¿«çš„æ„å»ºé€Ÿåº¦
- éœ€è¦æ‰“å° debug ä¿¡æ¯
- éœ€è¦ live reload æˆ– hot reload åŠŸèƒ½
- éœ€è¦ sourcemap æ–¹ä¾¿å®šä½é—®é¢˜
- ...

ç”Ÿäº§ç¯å¢ƒï¼š

- éœ€è¦æ›´å°çš„åŒ…ä½“ç§¯ï¼Œä»£ç å‹ç¼©+tree-shaking
- éœ€è¦è¿›è¡Œä»£ç åˆ†å‰²
- éœ€è¦å‹ç¼©å›¾ç‰‡ä½“ç§¯
- ...

åŒæ ·ä¹Ÿæœ‰ä¸åŒæ–¹æ³•ï¼š

**ç¬¬ä¸€ç§ï¼š**

1. åˆ›å»º`webpack.dev.js` å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶
2. åˆ›å»º`webpack.prod.js` ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
3. åœ¨`webpack.config.js`åŒºåˆ†æ‰“åŒ…

**ç¬¬äºŒç§ï¼š**

1. æœ¬åœ°å®‰è£… [cross-env](https://www.npmjs.com/package/cross-env)

```bash
npm install cross-env -D
```

2. é…ç½®å¯åŠ¨å‘½ä»¤

æ‰“å¼€ ./package.json

```js
"scripts": {
    "dev": "cross-env NODE_ENV=dev webpack serve --mode development",
    "test": "cross-env NODE_ENV=test webpack --mode production",
    "build": "cross-env NODE_ENV=prod webpack --mode production"
  },
```

3. åœ¨ Webpack é…ç½®æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡
   æ ¸å¿ƒä»£ç ï¼š
   ![](https://s2.loli.net/2022/01/09/9hGRxgpONyz2VjY.png)

4. æµ‹è¯•

- æ‰§è¡Œ `npm run build`

```js
//è¾“å‡º
process.env.NODE_ENV = prod;
argv.mode = production;
```

- æ‰§è¡Œ `npm run test`

```js
//è¾“å‡º
process.env.NODE_ENV = prod;
argv.mode = production;
```

- æ‰§è¡Œ `npm run dev`

```js
//è¾“å‡º
process.env.NODE_ENV = prod;
argv.mode = production;
```

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸åŒçš„ç¯å¢ƒæ¥åŠ¨æ€ä¿®æ”¹ Webpack çš„é…ç½®

### ä½¿ç”¨ devServer

1.å®‰è£… webpack-dev-server

```bash
npm intall webpack-dev-server@3.11.2 -D || npm intall webpack-dev-server
```

::: danger æ³¨æ„
âš ï¸ æ³¨æ„ï¼šè‹¥ä½¿ç”¨çš„ webpack-dev-server ç‰ˆæœ¬æ˜¯ 3.11.2ï¼Œå½“ç‰ˆæœ¬ version >= 4.0.0 æ—¶ï¼Œéœ€è¦ä½¿ç”¨ devServer.static è¿›è¡Œé…ç½®ï¼Œä¸å†æœ‰ devServer.contentBase é…ç½®é¡¹ã€‚
:::

:::: code-group

```js [version = @3.11.2] {5}
// webpack.config.js
const config = {
  // ...
  devServer: {
    contentBase: path.resolve(__dirname, "public"), // æ–‡ä»¶ç›®å½•
    //compress: true, //æ˜¯å¦å¯åŠ¨å‹ç¼© gzip
    //port: 8080, // ç«¯å£å·
    // open:true  // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  },
  // ...
};
```

```js [version > @4.x.x] {5}
// webpack.config.js
const config = {
  // ...
  devServer: {
    static: "./index.html", // é™æ€æ–‡ä»¶ç›®å½•
    //compress: true, //æ˜¯å¦å¯åŠ¨å‹ç¼© gzip
    //port: 8080, // é»˜è®¤ç«¯å£å·
    // open:true  // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  },
  // ...
};
```

::::

ä¸ºä»€ä¹ˆè¦é…ç½® contentBase æˆ– static ï¼Ÿ

å› ä¸º `webpack` åœ¨è¿›è¡Œæ‰“åŒ…çš„æ—¶å€™ï¼Œå¯¹é™æ€æ–‡ä»¶çš„å¤„ç†ï¼Œä¾‹å¦‚å›¾ç‰‡ï¼Œéƒ½æ˜¯ç›´æ¥ copy åˆ° dist ç›®å½•ä¸‹é¢ã€‚ä½†æ˜¯å¯¹äºæœ¬åœ°å¼€å‘æ¥è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹å¤ªè´¹æ—¶ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ï¼Œæ‰€ä»¥åœ¨è®¾ç½® `contentBase` ä¹‹åï¼Œå°±ç›´æ¥åˆ°å¯¹åº”çš„é™æ€ç›®å½•ä¸‹é¢å»è¯»å–æ–‡ä»¶ï¼Œè€Œä¸éœ€å¯¹æ–‡ä»¶åšä»»ä½•ç§»åŠ¨ï¼ŒèŠ‚çœäº†æ—¶é—´å’Œæ€§èƒ½å¼€é”€ã€‚
